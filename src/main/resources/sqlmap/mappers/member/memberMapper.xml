<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bx.bxbms.member.dao.MemberMapper">
		
		<!-- 회원가입 -->
		<insert id="memberSignUp">
			INSERT INTO BX_MEMB_M(
			  USER_ID
			, USER_PASS
			, USER_NM
			, COM_NM
			, DEPT_NM
			, POSITION
			, PHONE_NO
			, EML_ADDR 
			, ROLE_ID
			, MEMB_ST
			)VALUES(
			  #{userId}
			, #{userPass}
			, #{userNm}
			, #{comNm}
			, #{deptNm}
			, #{position}
			, #{phoneNo}
			, #{emlAddr}
			, 'USER'
			, 'Y'
			)
	</insert>
	
		<!--로그인 -->
		<select id="login" parameterType="memberVO" resultType="memberVO">
			SELECT 
				USER_ID
				,USER_PASS
				,USER_NM 
				,MEM_ID
				,ROLE_ID
		    FROM bxbms.BX_MEMB_M 
		    WHERE USER_ID = #{userId}
		      AND MEMB_ST = 'Y'
		</select>
		
		<!-- 회원정보 수정 --> 
		<update id="memberModify" parameterType="memberVO" >
			 UPDATE BX_MEMB_M
			  SET
			   USER_Id = #{userId}
			   ,USER_NM = #{userNm}
			   ,COM_NM = #{comNm}
			   ,DEPT_NM = #{deptNm}
			   ,POSITION = #{position}
			   ,PHONE_NO = #{phoneNo}
			   ,EML_ADDR = #{emlAddr}
			   ,ADDR = #{addr}
			  where MEM_ID = #{memId}  
		</update>
		
		<!-- 회원 탈퇴 --> 
		<update id="memberStModify">
			 UPDATE BX_MEMB_M
			  SET
			   MEMB_ST = 'N'
			  where USER_ID = #{userId}  
		</update>
	
		<!-- 회원 상세 -->
		<select id="memberInfo" parameterType="String" resultType="memberVO">
			SELECT 
				USER_ID
				,USER_NM 
				,MEM_ID
				,COM_NM
				,DEPT_NM
				,POSITION
				,EML_ADDR
				,ADDR
				,(SELECT ROLE_NM FROM bx_role_m A INNER JOIN BX_MEMB_M B ON A.ROLE_ID = B.ROLE_ID where A.ROLE_ID ='USER' and B.MEM_ID = #{memId}) AS ROLE_NM
		    FROM BX_MEMB_M 
		    WHERE MEM_ID = #{memId} 
		      AND MEMB_ST = 'Y'
		</select>
		
		<!-- 회원비밀번호 수정 --> 
		<update id="memberPassModify" parameterType="memberVO" >
			 UPDATE bxbms.BX_MEMB_M
			  SET
			   USER_PASS = #{userPass}
			  where MEM_ID = #{memId}  
			  	and USER_ID = #{userId} 
		</update>
	
		<!--회원목록-->
		<select id="memberList" parameterType="memberVO" resultType="memberVO">
			SELECT
			 MEM_ID
			, USER_ID
			, USER_NM
			, COM_NM
			, DEPT_NM
			, POSITION
			, MEMB_ST
			, ROLE_ID
			, (SELECT ROLE_NM FROM BX_ROLE_M where ROLE_ID = BX_MEMB_M.ROLE_ID ) as ROLE_NM
			, REG_DT
			FROM bxbms.BX_MEMB_M
		</select>
		
		<!-- 아이디 중복검사 -->
		<select id="idCheck" parameterType="memberVO" resultType="int">
			SELECT
				COUNT(*)
			FROM
				bxbms.BX_MEMB_M
			WHERE
				USER_ID = #{userId} 
		</select>
		
		<!-- 관리자 회원 정보 수정 --> 
		<update id="adminmemberModify" parameterType="memberVO">
			 UPDATE BX_MEMB_M
			  SET
			   MEMB_ST =  #{membSt} 
			   ,ROLE_ID = #{roleId}
			   ,REG_DT = #{regDt}
			  where MEM_ID = #{memId}  
		</update>
		
		<delete id="deleteMember" parameterType="memberVO">
			DELETE 
				FROM BX_MEMB_M 
			WHERE 
			   MEM_ID = #{userId}
		</delete>
		
</mapper>